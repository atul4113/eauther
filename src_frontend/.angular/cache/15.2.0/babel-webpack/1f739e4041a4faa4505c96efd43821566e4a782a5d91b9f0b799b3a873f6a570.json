{"ast":null,"code":"import { Observable } from 'rxjs/Observable';\nimport { map, share } from 'rxjs/operators';\nimport { SettingsService } from './settings.service';\nimport { CookieService } from \"./cookie/cookies.service\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./cookie/cookies.service\";\nimport * as i2 from \"./settings.service\";\nvar HOME_REFERRER_COOKIE = 'home_referer';\nvar HOME_DEFAULT = 'default';\nvar ReferrerService = /** @class */function () {\n  function ReferrerService(_cookie, _settings) {\n    this._cookie = _cookie;\n    this._settings = _settings;\n  }\n  ReferrerService.prototype.setHomeReferrerCookie = function (referrer) {\n    if (referrer === void 0) {\n      referrer = '';\n    }\n    var dateYearPlus = new Date();\n    dateYearPlus.setTime(dateYearPlus.getTime() + 365 * 24 * 3600 * 1000);\n    this._cookie.put(HOME_REFERRER_COOKIE, referrer, {\n      expires: dateYearPlus\n    });\n  };\n  ReferrerService.prototype.mapReferrer = function (settings, referrerKey, currentLanguage) {\n    if (referrerKey === void 0) {\n      referrerKey = null;\n    }\n    if (currentLanguage === void 0) {\n      currentLanguage = null;\n    }\n    if (settings.referrers) {\n      var referrers = settings.referrers;\n      var referrer = null;\n      var httpReferrer = document.referrer;\n      if (referrerKey && referrers[referrerKey]) {\n        referrer = referrerKey;\n      } else if (referrers[httpReferrer]) {\n        referrer = httpReferrer;\n      } else if (httpReferrer === '') {\n        referrer = '';\n      } else {\n        var referrerCookie = this._cookie.get(HOME_REFERRER_COOKIE);\n        if (referrerCookie) {\n          referrer = referrerCookie;\n        } else {\n          referrer = '';\n        }\n      }\n      if (referrer === '') {\n        var languageKeyReferrer = HOME_DEFAULT + '_' + currentLanguage.key;\n        if (currentLanguage && referrers[languageKeyReferrer]) {\n          referrer = languageKeyReferrer;\n        } else if (referrers[HOME_DEFAULT]) {\n          referrer = HOME_DEFAULT;\n        }\n        this.setHomeReferrerCookie('');\n      } else {\n        this.setHomeReferrerCookie(referrer);\n      }\n      return referrers[referrer];\n    } else {\n      return null;\n    }\n  };\n  ReferrerService.prototype.getReferrerUrl = function (referrerKey, currentLanguage) {\n    var _this = this;\n    if (referrerKey === void 0) {\n      referrerKey = null;\n    }\n    if (currentLanguage === void 0) {\n      currentLanguage = null;\n    }\n    if (this.referrerUrl) {\n      return Observable.of(this.referrerUrl);\n    } else if (this.observe) {\n      return this.observe;\n    } else {\n      this.observe = this._settings.get().pipe(map(function (response) {\n        return _this.mapReferrer(response, referrerKey, currentLanguage);\n      }), share());\n      this.observe.subscribe(function (referrerUrl) {\n        return _this.referrerUrl = referrerUrl;\n      });\n      return this.observe;\n    }\n  };\n  ReferrerService.ɵfac = function ReferrerService_Factory(t) {\n    return new (t || ReferrerService)(i0.ɵɵinject(i1.CookieService), i0.ɵɵinject(i2.SettingsService));\n  };\n  ReferrerService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ReferrerService,\n    factory: ReferrerService.ɵfac\n  });\n  return ReferrerService;\n}();\nexport { ReferrerService };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}